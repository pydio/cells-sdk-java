# Developer Corner

We gather here info and tips for current and future developers of the Java SDK.

## Regenerate the SDK

We use [swagger-codegen](https://swagger.io/docs/open-source-tools/swagger-codegen/) to generate the java client.


For the time being, we rather clone the repository in a temp location to generate the new version of the code and then replace the `com.pydio.cells.openapi` package in the local repository, to avoid polluting the main repo with autogenerated files (gradle, doc, config files...)

```sh
mkdir -p /tmp/forSwagger
cd /tmp/forSwagger
git clone https://bsinou@github.com/pydio/cells-sdk-java.git
cd cells-sdk-java

SWAGGER_VERSION=2.4.23
wget https://oss.sonatype.org/content/repositories/releases/io/swagger/swagger-codegen-cli/${SWAGGER_VERSION}/swagger-codegen-cli-${SWAGGER_VERSION}.jar -O swagger-codegen-cli.jar

# WARNING: Update
SDK_DEFAULT_AGENT="PydioCells/v3.0.1/JavaSDK/v0.3.0"

java -jar swagger-codegen-cli.jar generate -l java -i https://raw.githubusercontent.com/pydio/cells/stable/common/proto/rest/rest.swagger.json \
    --invoker-package com.pydio.cells.openapi \
    --api-package com.pydio.cells.openapi.api \
    --model-package com.pydio.cells.openapi.model \
    --http-user-agent ${SDK_DEFAULT_AGENT}

cd $GITPATH/github.com/pydio/cells-android-client/sdk-java/src/main/java/com/pydio/cells/
rm -rf ./openapi

mv /tmp/forSwagger/cells-sdk-java/src/main/java/com/pydio/cells/openapi .

# For the record, more details about the possible options:
java -jar swagger-codegen-cli.jar help generate
```

### With OpenAPI 3

```sh
mkdir -p /tmp/forSwagger
cd /tmp/forSwagger
git clone https://bsinou@github.com/pydio/cells-sdk-java.git
cd cells-sdk-java

GENERATOR_VERSION=5.4.0
wget https://oss.sonatype.org/content/repositories/releases/org/openapitools/openapi-generator-cli/${GENERATOR_VERSION}/openapi-generator-cli-${GENERATOR_VERSION}.jar -O openapi-generator-cli.jar


# WARNING: Update
SDK_DEFAULT_AGENT="PydioCells/v3.0.4/JavaSDK/v0.4.0"

```

(Temp) _A la mano_
- Retrieve default json swagger v2 spec file: https://raw.githubusercontent.com/pydio/cells/stable/common/proto/rest/rest.swagger.json
- Copy paste spac file at: https://editor.swagger.io/
- use Edit / convert to v3
- paste back the specs in the root java project typically in rest.v3.swagger.yml

```
java -jar openapi-generator-cli.jar generate -g java \
    -i ./rest.v3.swagger.yml \
    -o /tmp/forSwagger/cells-sdk-java \
    --invoker-package com.pydio.cells.openapi \
    --api-package com.pydio.cells.openapi.api \
    --model-package com.pydio.cells.openapi.model
    --http-user-agent ${SDK_DEFAULT_AGENT}

cd $GITPATH/github.com/bsinou/pydia/sdk-java/src/main/java/com/pydio/cells/
rm -rf ./openapi

mv /tmp/forSwagger/cells-sdk-java/src/main/java/com/pydio/cells/openapi .

# For the record, more details about the possible options:
java -jar swagger-codegen-cli.jar help generate
```



## Developer Tips

### Testing OAuth with a Cells server

When testing OAuth and app behaviour on the long run, it might be useful to reduce the validity duration of the JWT token.
To do this, simply (backup and) impact your main `pydio.json` configuration file to add this param:

`"services"."pydio.web.oauth"."refreshTokenLifespan":"1m"`

For the record, validity duration is expressed as a [go duration](https://pkg.go.dev/time#Duration), and is set by default to 10 minutes (`10m`).

### Various

A list of random resources on the _WWW_ that have helped along the way and are kept here for reference.

- We use git submodules to ease day-to-day development work, see [this interesting post](https://blog.bitsrc.io/how-to-utilize-submodules-within-git-repos-5dfdd1c62d09)
- A [must read](https://auth0.com/docs/flows/call-your-api-using-the-authorization-code-flow) to understand how we manage authentication when target remote server is a Pydio Cells instance.

### Temporary Tips

#### For refactoring

- We might want to change the package that is used by the swagger generated model and rename packages in a future proof way. We will go trough a temporary phase where we put generated methods at 2 distinct locations while deprecating the legacy one. Some solution can be found in [this stackoverflow question](https://stackoverflow.com/questions/5074454/what-is-the-clearest-way-to-deprecate-a-package-in-java).
